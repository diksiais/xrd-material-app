<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Material Analysis App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.plot.ly/plotly-2.20.0.min.js"></script>
    <script src="https://unpkg.com/regression@2.0.1/dist/regression.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-gray-100 min-h-screen p-4 sm:p-8 flex justify-center">

    <main class="w-full max-w-5xl space-y-8">
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-gray-800 tracking-tight">Material Analysis Platform</h1>
        <p class="text-center text-gray-600">Analyze XRD, IR, and BET data with AI assistance.</p>

        <section class="bg-white p-6 rounded-2xl shadow-xl border border-gray-200">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">XRD Analysis & Comparison</h2>
            <form id="xrdForm" class="space-y-4">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="xrdOriginalFile" class="block text-sm font-medium text-gray-700">Original XRD Data (CSV)</label>
                        <input type="file" id="xrdOriginalFile" name="original_file" accept=".csv" required class="mt-1 block w-full text-sm text-gray-500
                            file:mr-4 file:py-2 file:px-4
                            file:rounded-full file:border-0
                            file:text-sm file:font-semibold
                            file:bg-blue-50 file:text-blue-700
                            hover:file:bg-blue-100"/>
                    </div>
                    <div>
                        <label for="xrdModifiedFile" class="block text-sm font-medium text-gray-700">Modified XRD Data (CSV)</label>
                        <input type="file" id="xrdModifiedFile" name="modified_file" accept=".csv" required class="mt-1 block w-full text-sm text-gray-500
                            file:mr-4 file:py-2 file:px-4
                            file:rounded-full file:border-0
                            file:text-sm file:font-semibold
                            file:bg-blue-50 file:text-blue-700
                            hover:file:bg-blue-100"/>
                    </div>
                </div>
                <div>
                    <label for="xrdExplanation" class="block text-sm font-medium text-gray-700">Modification Description (Optional)</label>
                    <textarea id="xrdExplanation" name="explanation" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"></textarea>
                </div>
                <div>
                    <label for="xrdQuery" class="block text-sm font-medium text-gray-700">Specific Query (Optional)</label>
                    <textarea id="xrdQuery" name="ai_query" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"></textarea>
                </div>
                <button type="submit" id="xrdSubmitBtn" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    Analyze XRD Data
                </button>
            </form>

            <div id="xrdResult" class="mt-6 hidden">
                <h3 class="text-xl font-semibold mb-2 text-gray-800">XRD Analysis Results</h3>
                <div id="xrdPlots" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div id="xrdOriginalPlot"></div>
                    <div id="xrdModifiedPlot"></div>
                </div>
                <div id="xrdAiSuggestion" class="mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                    <h4 class="text-lg font-semibold text-blue-800 mb-2">AI Interpretation</h4>
                    <div class="markdown-content text-blue-700"></div>
                </div>
            </div>

            <div id="xrdFollowUpSection" class="mt-4 hidden p-4 bg-gray-50 rounded-lg border border-gray-200">
                <h4 class="text-lg font-semibold text-gray-800 mb-2">Follow-up Question</h4>
                <div class="w-full">
                    <textarea id="xrdFollowUpQuery" placeholder="Ask a follow-up question..." rows="2" class="mt-1 w-full rounded-md border-gray-300 shadow-sm p-3 focus:border-blue-500 focus:ring-blue-500 rounded-lg"></textarea>
                    <button id="xrdFollowUpBtn" class="mt-3 w-full flex justify-center py-2 px-4 rounded-lg shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700">Submit Follow-up</button>
                </div>
            </div>

            <div id="xrdLoading" class="hidden mt-4 text-center text-gray-500 animate-pulse">Analyzing XRD data...</div>
            <div id="xrdError" class="mt-4 hidden text-sm text-red-600 p-3 bg-red-50 rounded-lg"></div>
            <div id="xrdHistoryDisplay" class="hidden mt-6 bg-gray-50 p-4 rounded-lg border border-gray-200"></div>
            <button id="xrdHistoryBtn" class="mt-4 text-sm text-blue-700 underline">View XRD Analysis History</button>
            <div id="xrdHistoryContainer" class="hidden mt-2 p-3 bg-gray-100 rounded-lg text-sm">
                <div class="mb-2">
                    <label for="xrdSearch" class="sr-only">Search History</label>
                    <input type="text" id="xrdSearch" placeholder="Search history..." class="w-full rounded-md border-gray-300 shadow-sm p-2 text-sm">
                </div>
                <div id="xrdHistoryContent"></div>
            </div>
        </section>

        <section class="bg-white p-6 rounded-2xl shadow-xl border border-gray-200">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">IR Analysis & Comparison</h2>
            <form id="irForm" class="space-y-4">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="irOriginalFile" class="block text-sm font-medium text-gray-700">Original IR Data (CSV)</label>
                        <input type="file" id="irOriginalFile" name="original_file" accept=".csv" required class="mt-1 block w-full text-sm text-gray-500
                            file:mr-4 file:py-2 file:px-4
                            file:rounded-full file:border-0
                            file:text-sm file:font-semibold
                            file:bg-purple-50 file:text-purple-700
                            hover:file:bg-purple-100"/>
                    </div>
                    <div>
                        <label for="irModifiedFile" class="block text-sm font-medium text-gray-700">Modified IR Data (CSV)</label>
                        <input type="file" id="irModifiedFile" name="modified_file" accept=".csv" required class="mt-1 block w-full text-sm text-gray-500
                            file:mr-4 file:py-2 file:px-4
                            file:rounded-full file:border-0
                            file:text-sm file:font-semibold
                            file:bg-purple-50 file:text-purple-700
                            hover:file:bg-purple-100"/>
                    </div>
                </div>
                <div>
                    <label for="irExplanation" class="block text-sm font-medium text-gray-700">Modification Description (Optional)</label>
                    <textarea id="irExplanation" name="explanation" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 sm:text-sm"></textarea>
                </div>
                <div>
                    <label for="irQuery" class="block text-sm font-medium text-gray-700">Specific Query (Optional)</label>
                    <textarea id="irQuery" name="ai_query" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 sm:text-sm"></textarea>
                </div>
                <button type="submit" id="irSubmitBtn" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500">
                    Analyze IR Data
                </button>
            </form>

            <div id="irResult" class="mt-6 hidden">
                <h3 class="text-xl font-semibold mb-2 text-gray-800">IR Analysis Results</h3>
                <div id="irPlots" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div id="irOriginalPlot"></div>
                    <div id="irModifiedPlot"></div>
                </div>
                <div id="irAiSuggestion" class="mt-4 p-4 bg-purple-50 rounded-lg border border-purple-200">
                    <h4 class="text-lg font-semibold text-purple-800 mb-2">AI Interpretation</h4>
                    <div class="markdown-content text-purple-700"></div>
                </div>
            </div>

            <div id="irFollowUpSection" class="mt-4 hidden p-4 bg-gray-50 rounded-lg border border-gray-200">
                <h4 class="text-lg font-semibold text-gray-800 mb-2">Follow-up Question</h4>
                <div class="w-full">
                    <textarea id="irFollowUpQuery" placeholder="Ask a follow-up question..." rows="2" class="mt-1 w-full rounded-md border-gray-300 shadow-sm p-3 focus:border-purple-500 focus:ring-purple-500 rounded-lg"></textarea>
                    <button id="irFollowUpBtn" class="mt-3 w-full flex justify-center py-2 px-4 rounded-lg shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700">Submit Follow-up</button>
                </div>
            </div>

            <div id="irLoading" class="hidden mt-4 text-center text-gray-500 animate-pulse">Analyzing IR data...</div>
            <div id="irError" class="mt-4 hidden text-sm text-red-600 p-3 bg-red-50 rounded-lg"></div>
            <div id="irHistoryDisplay" class="hidden mt-6 bg-gray-50 p-4 rounded-lg border border-gray-200"></div>
            <button id="irHistoryBtn" class="mt-4 text-sm text-purple-700 underline">View IR Analysis History</button>
            <div id="irHistoryContainer" class="hidden mt-2 p-3 bg-gray-100 rounded-lg text-sm">
                <div class="mb-2">
                    <label for="irSearch" class="sr-only">Search History</label>
                    <input type="text" id="irSearch" placeholder="Search history..." class="w-full rounded-md border-gray-300 shadow-sm p-2 text-sm">
                </div>
                <div id="irHistoryContent"></div>
            </div>
        </section>

        <section class="bg-white p-6 rounded-2xl shadow-xl border border-gray-200">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">BET Analysis & Comparison</h2>
            <form id="betForm" class="space-y-4">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="betOriginalFile" class="block text-sm font-medium text-gray-700">Original BET Data (CSV/PDF)</label>
                        <input type="file" id="betOriginalFile" name="original_file" accept=".csv, .pdf" class="mt-1 block w-full text-sm text-gray-500
                            file:mr-4 file:py-2 file:px-4
                            file:rounded-full file:border-0
                            file:text-sm file:font-semibold
                            file:bg-emerald-50 file:text-emerald-700
                            hover:file:bg-emerald-100"/>
                    </div>
                    <div>
                        <label for="betModifiedFile" class="block text-sm font-medium text-gray-700">Modified BET Data (CSV/PDF)</label>
                        <input type="file" id="betModifiedFile" name="modified_file" accept=".csv, .pdf" class="mt-1 block w-full text-sm text-gray-500
                            file:mr-4 file:py-2 file:px-4
                            file:rounded-full file:border-0
                            file:text-sm file:font-semibold
                            file:bg-emerald-50 file:text-emerald-700
                            hover:file:bg-emerald-100"/>
                    </div>
                </div>
                <div>
                    <label for="betExplanation" class="block text-sm font-medium text-gray-700">Modification Description (Optional)</label>
                    <textarea id="betExplanation" name="explanation" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-emerald-500 focus:ring-emerald-500 sm:text-sm"></textarea>
                </div>
                <div>
                    <label for="betQuery" class="block text-sm font-medium text-gray-700">Specific Query (Optional)</label>
                    <textarea id="betQuery" name="ai_query" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-emerald-500 focus:ring-emerald-500 sm:text-sm"></textarea>
                </div>
                <button type="submit" id="betSubmitBtn" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500">
                    Analyze BET Data
                </button>
            </form>

            <div id="betResult" class="mt-6 hidden">
                <h3 class="text-xl font-semibold mb-2 text-gray-800">BET Analysis Results</h3>
                <div id="betPlots" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div id="betOriginalPlot"></div>
                    <div id="betModifiedPlot"></div>
                </div>
                <div id="betSurfaceArea" class="mt-4 p-4 bg-emerald-50 rounded-lg border border-emerald-200">
                    <h4 class="text-lg font-semibold text-emerald-800 mb-2">Calculated Surface Areas</h4>
                    <p class="text-emerald-700">Original Surface Area: <span id="originalSurfaceArea"></span> m²/g</p>
                    <p class="text-emerald-700">Modified Surface Area: <span id="modifiedSurfaceArea"></span> m²/g</p>
                </div>
                <div id="betAiSuggestion" class="mt-4 p-4 bg-emerald-50 rounded-lg border border-emerald-200">
                    <h4 class="text-lg font-semibold text-emerald-800 mb-2">AI Interpretation</h4>
                    <div class="markdown-content text-emerald-700"></div>
                </div>
            </div>

            <div id="betFollowUpSection" class="mt-4 hidden p-4 bg-gray-50 rounded-lg border border-gray-200">
                <h4 class="text-lg font-semibold text-gray-800 mb-2">Follow-up Question</h4>
                <div class="w-full">
                    <textarea id="betFollowUpQuery" placeholder="Ask a follow-up question..." rows="2" class="mt-1 w-full rounded-md border-gray-300 shadow-sm p-3 focus:border-emerald-500 focus:ring-emerald-500 rounded-lg"></textarea>
                    <button id="betFollowUpBtn" class="mt-3 w-full flex justify-center py-2 px-4 rounded-lg shadow-sm text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700">Submit Follow-up</button>
                </div>
            </div>

            <div id="betLoading" class="hidden mt-4 text-center text-gray-500 animate-pulse">Analyzing BET data...</div>
            <div id="betError" class="mt-4 hidden text-sm text-red-600 p-3 bg-red-50 rounded-lg"></div>
            <div id="betHistoryDisplay" class="hidden mt-6 bg-gray-50 p-4 rounded-lg border border-gray-200"></div>
            <button id="betHistoryBtn" class="mt-4 text-sm text-emerald-700 underline">View BET Analysis History</button>
            <div id="betHistoryContainer" class="hidden mt-2 p-3 bg-gray-100 rounded-lg text-sm">
                <div class="mb-2">
                    <label for="betSearch" class="sr-only">Search History</label>
                    <input type="text" id="betSearch" placeholder="Search history..." class="w-full rounded-md border-gray-300 shadow-sm p-2 text-sm">
                </div>
                <div id="betHistoryContent"></div>
            </div>
        </section>

        <section class="bg-white p-6 rounded-2xl shadow-xl border border-gray-200">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">TGA Analysis</h2>
            <form id="tgaForm" class="space-y-4">
                <div class="grid grid-cols-1 gap-4">
                    <div>
                        <label for="tgaFile" class="block text-sm font-medium text-gray-700">TGA Data (CSV)</label>
                        <input type="file" id="tgaFile" name="tga_file" accept=".csv" required class="mt-1 block w-full text-sm text-gray-500
                            file:mr-4 file:py-2 file:px-4
                            file:rounded-full file:border-0
                            file:text-sm file:font-semibold
                            file:bg-orange-50 file:text-orange-700
                            hover:file:bg-orange-100"/>
                    </div>
                </div>
                <div>
                    <label for="tgaQuery" class="block text-sm font-medium text-gray-700">Specific Query (Optional)</label>
                    <textarea id="tgaQuery" name="ai_query" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-sm"></textarea>
                </div>
                <button type="submit" id="tgaSubmitBtn" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500">
                    Analyze TGA Data
                </button>
            </form>

            <div id="tgaResult" class="mt-6 hidden">
                <h3 class="text-xl font-semibold mb-2 text-gray-800">TGA Analysis Results</h3>
                <div id="tgaPlot"></div>
                <div id="tgaSummary" class="mt-4 p-4 bg-orange-50 rounded-lg border border-orange-200">
                    <h4 class="text-lg font-semibold text-orange-800 mb-2">Key Findings</h4>
                    <p class="text-orange-700">Total Weight Loss: <span id="totalWeightLoss"></span>%</p>
                    <p class="text-orange-700">DTG Peaks: <span id="tgaPeakInfo"></span></p>
                </div>
                <div id="tgaAiSuggestion" class="mt-4 p-4 bg-orange-50 rounded-lg border border-orange-200">
                    <h4 class="text-lg font-semibold text-orange-800 mb-2">AI Interpretation</h4>
                    <div class="markdown-content text-orange-700"></div>
                </div>
            </div>

            <div id="tgaFollowUpSection" class="mt-4 hidden p-4 bg-gray-50 rounded-lg border border-gray-200">
                <h4 class="text-lg font-semibold text-gray-800 mb-2">Follow-up Question</h4>
                <div class="w-full">
                    <textarea id="tgaFollowUpQuery" placeholder="Ask a follow-up question..." rows="2" class="mt-1 w-full rounded-md border-gray-300 shadow-sm p-3 focus:border-orange-500 focus:ring-orange-500 rounded-lg"></textarea>
                    <button id="tgaFollowUpBtn" class="mt-3 w-full flex justify-center py-2 px-4 rounded-lg shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700">Submit Follow-up</button>
                </div>
            </div>

            <div id="tgaLoading" class="hidden mt-4 text-center text-gray-500 animate-pulse">Analyzing TGA data...</div>
            <div id="tgaError" class="mt-4 hidden text-sm text-red-600 p-3 bg-red-50 rounded-lg"></div>
            <div id="tgaHistoryDisplay" class="hidden mt-6 bg-gray-50 p-4 rounded-lg border border-gray-200"></div>
            <button id="tgaHistoryBtn" class="mt-4 text-sm text-orange-700 underline">View TGA Analysis History</button>
            <div id="tgaHistoryContainer" class="hidden mt-2 p-3 bg-gray-100 rounded-lg text-sm">
                <div class="mb-2">
                    <label for="tgaSearch" class="sr-only">Search History</label>
                    <input type="text" id="tgaSearch" placeholder="Search history..." class="w-full rounded-md border-gray-300 shadow-sm p-2 text-sm">
                </div>
                <div id="tgaHistoryContent"></div>
            </div>
        </section>

        <section class="bg-white p-6 rounded-2xl shadow-xl border border-gray-200">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">Analyze All Data</h2>
            <form id="analyzeAllForm" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="xrdOriginalFileCombined" class="block text-sm font-medium text-gray-700">Original XRD Data (CSV)</label>
                        <input type="file" id="xrdOriginalFileCombined" name="original_xrd_file" accept=".csv" class="mt-1 block w-full text-sm text-gray-500
                            file:mr-4 file:py-2 file:px-4
                            file:rounded-full file:border-0
                            file:text-sm file:font-semibold
                            file:bg-blue-50 file:text-blue-700
                            hover:file:bg-blue-100"/>
                    </div>
                    <div>
                        <label for="xrdModifiedFileCombined" class="block text-sm font-medium text-gray-700">Modified XRD Data (CSV)</label>
                        <input type="file" id="xrdModifiedFileCombined" name="modified_xrd_file" accept=".csv" class="mt-1 block w-full text-sm text-gray-500
                            file:mr-4 file:py-2 file:px-4
                            file:rounded-full file:border-0
                            file:text-sm file:font-semibold
                            file:bg-blue-50 file:text-blue-700
                            hover:file:bg-blue-100"/>
                    </div>
                    <div>
                        <label for="irOriginalFileCombined" class="block text-sm font-medium text-gray-700">Original IR Data (CSV)</label>
                        <input type="file" id="irOriginalFileCombined" name="original_ir_file" accept=".csv" class="mt-1 block w-full text-sm text-gray-500
                            file:mr-4 file:py-2 file:px-4
                            file:rounded-full file:border-0
                            file:text-sm file:font-semibold
                            file:bg-purple-50 file:text-purple-700
                            hover:file:bg-purple-100"/>
                    </div>
                    <div>
                        <label for="irModifiedFileCombined" class="block text-sm font-medium text-gray-700">Modified IR Data (CSV)</label>
                        <input type="file" id="irModifiedFileCombined" name="modified_ir_file" accept=".csv" class="mt-1 block w-full text-sm text-gray-500
                            file:mr-4 file:py-2 file:px-4
                            file:rounded-full file:border-0
                            file:text-sm file:font-semibold
                            file:bg-purple-50 file:text-purple-700
                            hover:file:bg-purple-100"/>
                    </div>
                    <div>
                        <label for="betOriginalFileCombined" class="block text-sm font-medium text-gray-700">Original BET Data (CSV/PDF)</label>
                        <input type="file" id="betOriginalFileCombined" name="original_bet_file" accept=".csv, .pdf" class="mt-1 block w-full text-sm text-gray-500
                            file:mr-4 file:py-2 file:px-4
                            file:rounded-full file:border-0
                            file:text-sm file:font-semibold
                            file:bg-emerald-50 file:text-emerald-700
                            hover:file:bg-emerald-100"/>
                    </div>
                    <div>
                        <label for="betModifiedFileCombined" class="block text-sm font-medium text-gray-700">Modified BET Data (CSV/PDF)</label>
                        <input type="file" id="betModifiedFileCombined" name="modified_bet_file" accept=".csv, .pdf" class="mt-1 block w-full text-sm text-gray-500
                            file:mr-4 file:py-2 file:px-4
                            file:rounded-full file:border-0
                            file:text-sm file:font-semibold
                            file:bg-emerald-50 file:text-emerald-700
                            hover:file:bg-emerald-100"/>
                    </div>
                    <div>
                        <label for="tgaFileCombined" class="block text-sm font-medium text-gray-700">TGA Data (CSV)</label>
                        <input type="file" id="tgaFileCombined" name="tga_file" accept=".csv" class="mt-1 block w-full text-sm text-gray-500
                            file:mr-4 file:py-2 file:px-4
                            file:rounded-full file:border-0
                            file:text-sm file:font-semibold
                            file:bg-orange-50 file:text-orange-700
                            hover:file:bg-orange-100"/>
                    </div>
                </div>
                <div>
                    <label for="aiQueryCombined" class="block text-sm font-medium text-gray-700">Specific Query (Optional)</label>
                    <textarea id="aiQueryCombined" name="ai_query" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-pink-500 focus:ring-pink-500 sm:text-sm"></textarea>
                </div>
                <button type="submit" id="analyzeAllSubmitBtn" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-pink-600 hover:bg-pink-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pink-500">
                    Analyze All Data
                </button>
            </form>

            <div id="analyzeAllResult" class="mt-6 hidden">
                <h3 class="text-xl font-semibold mb-2 text-gray-800">Combined Analysis Results</h3>
                <div id="combinedPlots" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div id="xrdOriginalPlotCombined"></div>
                    <div id="xrdModifiedPlotCombined"></div>
                    <div id="irOriginalPlotCombined"></div>
                    <div id="irModifiedPlotCombined"></div>
                    <div id="betOriginalPlotCombined"></div>
                    <div id="betModifiedPlotCombined"></div>
                    <div id="tgaPlotCombined"></div>
                </div>
                <div id="combinedAiSuggestion" class="mt-4 p-4 bg-pink-50 rounded-lg border border-pink-200">
                    <h4 class="text-lg font-semibold text-pink-800 mb-2">AI Interpretation</h4>
                    <div class="markdown-content text-pink-700"></div>
                </div>
            </div>

            <div id="combinedFollowUpSection" class="mt-4 hidden p-4 bg-gray-50 rounded-lg border border-gray-200">
                <h4 class="text-lg font-semibold text-gray-800 mb-2">Follow-up Question</h4>
                <div class="w-full">
                    <textarea id="combinedFollowUpQuery" placeholder="Ask a follow-up question..." rows="2" class="mt-1 w-full rounded-md border-gray-300 shadow-sm p-3 focus:border-pink-500 focus:ring-pink-500 rounded-lg"></textarea>
                    <button id="combinedFollowUpBtn" class="mt-3 w-full flex justify-center py-2 px-4 rounded-lg shadow-sm text-sm font-medium text-white bg-pink-600 hover:bg-pink-700">Submit Follow-up</button>
                </div>
            </div>

            <div id="combinedLoading" class="hidden mt-4 text-center text-gray-500 animate-pulse">Analyzing all data...</div>
            <div id="combinedError" class="mt-4 hidden text-sm text-red-600 p-3 bg-red-50 rounded-lg"></div>
            <div id="combinedHistoryDisplay" class="hidden mt-6 bg-gray-50 p-4 rounded-lg border border-gray-200"></div>
            
            <button id="combinedHistoryBtn" class="mt-4 text-sm text-pink-700 underline">View Combined Analysis History</button>
            <div id="combinedHistoryContainer" class="hidden mt-2 p-3 bg-gray-100 rounded-lg text-sm">
                <div class="mb-2">
                    <label for="combinedSearch" class="sr-only">Search History</label>
                    <input type="text" id="combinedSearch" placeholder="Search history..." class="w-full rounded-md border-gray-300 shadow-sm p-2 text-sm">
                </div>
                <div id="combinedHistoryContent"></div>
            </div>
        </section>
    </main>

    <script src="scripts.js"></script>

</body>
</html>